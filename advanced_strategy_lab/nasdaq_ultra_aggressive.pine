//@version=5
strategy("NASDAQ ATR SuperTrend - Ultra Aggressive", shorttitle="NASDAQ Ultra", overlay=true, default_qty_type=strategy.percent_of_equity, default_qty_value=10)

// ============================================================================
// ULTRA AGRESSIF PARAMETRELER (Python testlerinden optimize edilmiş)
// ============================================================================
// Bu parametreler Python testlerinde en iyi sonuçları veren değerler
a = input.float(0.5, "ATR Sensitivity", minval=0.1, maxval=5.0, step=0.1, group="Ultra Aggressive Parameters")
c = input.int(2, "ATR Period", minval=1, maxval=20, group="Ultra Aggressive Parameters")
st_factor = input.float(0.4, "SuperTrend Factor", minval=0.1, maxval=3.0, step=0.1, group="Ultra Aggressive Parameters")

// NASDAQ-specific features (Python testlerinde False olanlar)
use_ema_confirmation = input.bool(false, "Use EMA Confirmation", group="NASDAQ Features")
use_heikin_ashi = input.bool(false, "Use Heikin Ashi", group="NASDAQ Features")
volume_filter = input.bool(false, "Use Volume Filter", group="NASDAQ Features")

// Risk Management (NASDAQ için optimize edilmiş)
stop_loss_pct = input.float(5.0, "Stop Loss %", minval=1.0, maxval=20.0, step=0.5, group="Risk Management")
take_profit_pct = input.float(15.0, "Take Profit %", minval=5.0, maxval=50.0, step=1.0, group="Risk Management")

// ============================================================================
// ATR SUPER TREND CALCULATION
// ============================================================================
atr_value = ta.atr(c)
hl2_value = hl2

// SuperTrend calculation (ultra aggressive)
super_trend_up = hl2_value - (a * atr_value)
super_trend_down = hl2_value + (st_factor * atr_value)

// SuperTrend direction
var float super_trend = na
var int super_trend_direction = na

if na(super_trend[1])
    super_trend := super_trend_up
    super_trend_direction := 1
else
    if super_trend_direction[1] == 1
        super_trend := math.max(super_trend_up, super_trend[1])
        super_trend_direction := super_trend == super_trend_up ? 1 : -1
    else
        super_trend := math.min(super_trend_down, super_trend[1])
        super_trend_direction := super_trend == super_trend_down ? -1 : 1

// ============================================================================
// SIGNAL GENERATION (Ultra Aggressive)
// ============================================================================
// Base signals
buy_signal = close > super_trend and close[1] <= super_trend[1]
sell_signal = close < super_trend and close[1] >= super_trend[1]

// ============================================================================
// STRATEGY EXECUTION
// ============================================================================
if buy_signal and strategy.position_size == 0
    stop_loss_price = close * (1 - stop_loss_pct / 100)
    take_profit_price = close * (1 + take_profit_pct / 100)
    
    strategy.entry("BUY", strategy.long)
    strategy.exit("BUY Exit", "BUY", stop=stop_loss_price, limit=take_profit_price)

if sell_signal and strategy.position_size == 0
    stop_loss_price = close * (1 + stop_loss_pct / 100)
    take_profit_price = close * (1 - take_profit_pct / 100)
    
    strategy.entry("SELL", strategy.short)
    strategy.exit("SELL Exit", "SELL", stop=stop_loss_price, limit=take_profit_price)

// ============================================================================
// PLOTTING
// ============================================================================
// SuperTrend line
plot(super_trend, "SuperTrend", color=close > super_trend ? color.green : color.red, linewidth=3)

// Signal markers
plotshape(buy_signal, "Buy Signal", shape.triangleup, location.belowbar, color.green, size=size.normal)
plotshape(sell_signal, "Sell Signal", shape.triangledown, location.abovebar, color.red, size=size.normal)

// ============================================================================
// PERFORMANCE INFORMATION
// ============================================================================
if barstate.islast
    var table perf_table = table.new(position.top_left, 2, 6, bgcolor=color.white, border_width=1)
    
    table.cell(perf_table, 0, 0, "Strategy", text_color=color.black, text_size=size.normal, bgcolor=color.yellow)
    table.cell(perf_table, 1, 0, "NASDAQ Ultra Aggressive", text_color=color.black, text_size=size.normal, bgcolor=color.yellow)
    
    table.cell(perf_table, 0, 1, "ATR Sensitivity", text_color=color.black, text_size=size.small)
    table.cell(perf_table, 1, 1, str.tostring(a), text_color=color.black, text_size=size.small)
    
    table.cell(perf_table, 0, 2, "ATR Period", text_color=color.black, text_size=size.small)
    table.cell(perf_table, 1, 2, str.tostring(c), text_color=color.black, text_size=size.small)
    
    table.cell(perf_table, 0, 3, "SuperTrend Factor", text_color=color.black, text_size=size.small)
    table.cell(perf_table, 1, 3, str.tostring(st_factor), text_color=color.black, text_size=size.small)
    
    table.cell(perf_table, 0, 4, "Stop Loss", text_color=color.black, text_size=size.small)
    table.cell(perf_table, 1, 4, str.tostring(stop_loss_pct) + "%", text_color=color.black, text_size=size.small)
    
    table.cell(perf_table, 0, 5, "Take Profit", text_color=color.black, text_size=size.small)
    table.cell(perf_table, 1, 5, str.tostring(take_profit_pct) + "%", text_color=color.black, text_size=size.small)

// ============================================================================
// ALERTS
// ============================================================================
alertcondition(buy_signal, "NASDAQ Ultra Buy", "NASDAQ Ultra Aggressive: BUY signal")
alertcondition(sell_signal, "NASDAQ Ultra Sell", "NASDAQ Ultra Aggressive: SELL signal")
