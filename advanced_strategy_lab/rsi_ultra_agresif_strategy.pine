//@version=5
strategy("RSI Ultra Agresif Strategy", shorttitle="RSI Ultra", overlay=false)

// === RSI Ultra Agresif Parametreleri ===
rsi_period = input.int(7, title="RSI Period", minval=1, maxval=50)
rsi_oversold = input.int(20, title="RSI Oversold Level", minval=5, maxval=40)
rsi_overbought = input.int(80, title="RSI Overbought Level", minval=60, maxval=95)

// === Risk Management ===
stop_loss_pct = input.float(1.0, title="Stop Loss %", minval=0.1, maxval=10.0, step=0.1)
take_profit_pct = input.float(2.0, title="Take Profit %", minval=0.1, maxval=20.0, step=0.1)

// === Strategy Settings ===
initial_capital = input.float(10000, title="Initial Capital", minval=1000)
default_qty_type = strategy.percent_of_equity
default_qty_value = 100

// === RSI Calculation ===
rsi_value = ta.rsi(close, rsi_period)

// === Signal Generation ===
// Buy Signal: RSI crosses above oversold level
buy_signal = ta.crossover(rsi_value, rsi_oversold)

// Sell Signal: RSI crosses below overbought level  
sell_signal = ta.crossunder(rsi_value, rsi_overbought)

// === Strategy Execution ===
if buy_signal
    strategy.entry("Long", strategy.long, comment="RSI Buy")
    
if sell_signal
    strategy.close("Long", comment="RSI Sell")

// === Stop Loss and Take Profit ===
if strategy.position_size > 0
    stop_price = strategy.position_avg_price * (1 - stop_loss_pct / 100)
    profit_price = strategy.position_avg_price * (1 + take_profit_pct / 100)
    
    strategy.exit("SL/TP", "Long", stop=stop_price, limit=profit_price, comment="SL/TP")

// === Plotting ===
// RSI Line
plot(rsi_value, title="RSI", color=color.blue, linewidth=2)

// Oversold and Overbought Levels
hline(rsi_oversold, title="Oversold", color=color.red, linestyle=hline.style_dashed)
hline(rsi_overbought, title="Overbought", color=color.green, linestyle=hline.style_dashed)
hline(50, title="Middle", color=color.gray, linestyle=hline.style_dotted)

// Background coloring
bgcolor(rsi_value > rsi_overbought ? color.new(color.red, 90) : 
        rsi_value < rsi_oversold ? color.new(color.green, 90) : na, title="RSI Background")

// Signal markers
plotshape(buy_signal, title="Buy Signal", location=location.belowbar, 
          color=color.green, style=shape.triangleup, size=size.small)
plotshape(sell_signal, title="Sell Signal", location=location.abovebar, 
          color=color.red, style=shape.triangledown, size=size.small)

// === Information Table ===
if barstate.islast
    var table info_table = table.new(position.top_right, 2, 6, bgcolor=color.white, border_width=1)
    
    table.cell(info_table, 0, 0, "Parameter", text_color=color.black, text_size=size.small)
    table.cell(info_table, 1, 0, "Value", text_color=color.black, text_size=size.small)
    
    table.cell(info_table, 0, 1, "RSI Period", text_color=color.black, text_size=size.small)
    table.cell(info_table, 1, 1, str.tostring(rsi_period), text_color=color.black, text_size=size.small)
    
    table.cell(info_table, 0, 2, "Oversold", text_color=color.black, text_size=size.small)
    table.cell(info_table, 1, 2, str.tostring(rsi_oversold), text_color=color.black, text_size=size.small)
    
    table.cell(info_table, 0, 3, "Overbought", text_color=color.black, text_size=size.small)
    table.cell(info_table, 1, 3, str.tostring(rsi_overbought), text_color=color.black, text_size=size.small)
    
    table.cell(info_table, 0, 4, "Stop Loss", text_color=color.black, text_size=size.small)
    table.cell(info_table, 1, 4, str.tostring(stop_loss_pct) + "%", text_color=color.black, text_size=size.small)
    
    table.cell(info_table, 0, 5, "Take Profit", text_color=color.black, text_size=size.small)
    table.cell(info_table, 1, 5, str.tostring(take_profit_pct) + "%", text_color=color.black, text_size=size.small)

// === Alerts ===
alertcondition(buy_signal, title="RSI Buy Signal", message="RSI crossed above {{plot(\"Oversold\")}} - Buy Signal")
alertcondition(sell_signal, title="RSI Sell Signal", message="RSI crossed below {{plot(\"Overbought\")}} - Sell Signal")

// === Performance Metrics ===
// Bu strateji Python testlerinde şu sonuçları verdi:
// - Ortalama Return: +17.39%
// - Win Rate: 77.6%
// - Ortalama İşlem Sayısı: 4.2
// - En İyi Hisse: TSLA (+28.42%)
// - Parametreler: RSI=7, Oversold=20, Overbought=80, SL=1%, TP=2%
