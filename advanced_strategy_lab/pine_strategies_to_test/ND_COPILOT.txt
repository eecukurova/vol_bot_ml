// This Pine Script™ code is subject to the terms of the Mozilla Public License 2.0 at https://mozilla.org/MPL/2.0/
// © pztf123456


//@version=5
indicator('ND EĞİTİM BORSA İZLEME EKRANI', overlay=true)
import loxx/loxxexpandedsourcetypes/4
////////////
// INPUTS //
grupSec = input.string(defval='1', options=['1', '2', '3', '4', '5','6','7','8','9','10','11','12','13','14','ÖZEL LİSTE'], group='Taraması yapılacak 40\'arlı gruplardan birini seçin', title='Grup seç')
per = input.timeframe(defval='', title='PERİYOT',group = "Tarama yapmak istediğiniz periyotu seçin")


col_width = input.float(5, title = "Column Width (%)", group = "Table Config")
scr_numb  = input.int(1, title = "Screen #", tooltip = '1 - rightmost screener', minval = 1, group = "Table Config")

// Colors Inputs //



// SYMBOLS // 
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
u01 = true
u02 = true
u03 = true
u04 = true
u05 = true
u06 = true
u07 = true
u08 = true
u09 = true
u10 = true
u11 = true
u12 = true
u13 = true
u14 = true
u15 = true
u16 = true
u17 = true
u18 = true
u19 = true
u20 = true



c01 = input.symbol("BMFBOVESPA:WDO1!")
c02 = input.symbol("PEPPERSTONE:BTCUSD")
c03 = input.symbol("TVC:GOLD")
c04 = input.symbol("FX:EURUSD")
c05 = input.symbol("FX:USDJPY")
c06 = input.symbol("FX:GBPUSD")
c07 = input.symbol("FX:USDCAD")
c08 = input.symbol("FX:USDSEK")
c09 = input.symbol("FX:USDCHF")
c10 = input.symbol("FX:EURGBP")
c11 = input.symbol("FX:GBPJPY")
c12 = input.symbol("FX:GBPAUD")
c13 = input.symbol("FX:AUDCAD")
c14 = input.symbol("PEPPERSTONE:USDSGD")
c15 = input.symbol("FX:NZDUSD")
c16 = input.symbol("FX:AUDUSD")
c17 = input.symbol("FX:EURAUD")
c18 = input.symbol("FX:EURCAD")
c19 = input.symbol("FX:EURCHF")
c20 = input.symbol("FX:EURJPY")




s01 = grupSec == '1' ? 'BIST:A1CAP' : grupSec == '2' ? 'BIST:ARENA' : grupSec == '3' ? 'BIST:BJKAS' : grupSec == '4' ? 'BIST:CWENE' : grupSec == '5' ? 'BIST:EKIZ'  : grupSec == '6' ? 'BIST:GENTS' : grupSec == '7' ? 'BIST:IHEVA' : grupSec == '8' ? 'BIST:KENT'  : grupSec == '9' ? 'BIST:LIDFA' : grupSec == '10' ? 'BIST:NATEN' : grupSec == '11' ? 'BIST:PKART' : grupSec == '12' ? 'BIST:SELGD' : grupSec == '13' ? 'BIST:TNZTP' : grupSec == '14' ? 'BIST:YATAS' :grupSec == "ÖZEL LİSTE" ? c01: na
s02 = grupSec == '1' ? 'BIST:ACSEL' : grupSec == '2' ? 'BIST:ARSAN' : grupSec == '3' ? 'BIST:BLCYT' : grupSec == '4' ? 'BIST:DAGHL' : grupSec == '5' ? 'BIST:EKSUN' : grupSec == '6' ? 'BIST:GEREL' : grupSec == '7' ? 'BIST:IHGZT' : grupSec == '8' ? 'BIST:KERVN' : grupSec == '9' ? 'BIST:LINK'  : grupSec == '10' ? 'BIST:NETAS' : grupSec == '11' ? 'BIST:PKENT' : grupSec == '12' ? 'BIST:SELVA' : grupSec == '13' ? 'BIST:TOASO' : grupSec == '14' ? 'BIST:YAYLA' :grupSec == "ÖZEL LİSTE" ? c02: na
s03 = grupSec == '1' ? 'BIST:ADEL'  : grupSec == '2' ? 'BIST:ARZUM' : grupSec == '3' ? 'BIST:BMSCH' : grupSec == '4' ? 'BIST:DAGI'  : grupSec == '5' ? 'BIST:ELITE' : grupSec == '6' ? 'BIST:GESAN' : grupSec == '7' ? 'BIST:IHLAS' : grupSec == '8' ? 'BIST:KERVT' : grupSec == '9' ? 'BIST:LKMNH' : grupSec == '10' ? 'BIST:NIBAS' : grupSec == '11' ? 'BIST:PLTUR' : grupSec == '12' ? 'BIST:SEYKM' : grupSec == '13' ? 'BIST:TRCAS' : grupSec == '14' ? 'BIST:YBTAS' :grupSec == "ÖZEL LİSTE" ? c03: na
s04 = grupSec == '1' ? 'BIST:ADESE' : grupSec == '2' ? 'BIST:ASELS' : grupSec == '3' ? 'BIST:BMSTL' : grupSec == '4' ? 'BIST:DAPGM' : grupSec == '5' ? 'BIST:EMKEL' : grupSec == '6' ? 'BIST:GIPTA' : grupSec == '7' ? 'BIST:IHLGM' : grupSec == '8' ? 'BIST:KFEIN' : grupSec == '9' ? 'BIST:LOGO'  : grupSec == '10' ? 'BIST:NTGAZ' : grupSec == '11' ? 'BIST:PNLSN' : grupSec == '12' ? 'BIST:SILVR' : grupSec == '13' ? 'BIST:TRGYO' : grupSec == '14' ? 'BIST:YEOTK' :grupSec == "ÖZEL LİSTE" ? c04: na
s05 = grupSec == '1' ? 'BIST:ADGYO' : grupSec == '2' ? 'BIST:ASGYO' : grupSec == '3' ? 'BIST:BNTAS' : grupSec == '4' ? 'BIST:DARDL' : grupSec == '5' ? 'BIST:EMNIS' : grupSec == '6' ? 'BIST:GLBMD' : grupSec == '7' ? 'BIST:IHYAY' : grupSec == '8' ? 'BIST:KGYO'  : grupSec == '9' ? 'BIST:LRSHO' : grupSec == '10' ? 'BIST:NTHOL' : grupSec == '11' ? 'BIST:PNSUT' : grupSec == '12' ? 'BIST:SISE'  : grupSec == '13' ? 'BIST:TRILC' : grupSec == '14' ? 'BIST:YESIL' :grupSec == "ÖZEL LİSTE" ? c05: na
s06 = grupSec == '1' ? 'BIST:AEFES' : grupSec == '2' ? 'BIST:ASTOR' : grupSec == '3' ? 'BIST:BOBET' : grupSec == '4' ? 'BIST:DENGE' : grupSec == '5' ? 'BIST:ENERY' : grupSec == '6' ? 'BIST:GLCVY' : grupSec == '7' ? 'BIST:IMASM' : grupSec == '8' ? 'BIST:KIMMR' : grupSec == '9' ? 'BIST:LUKSK' : grupSec == '10' ? 'BIST:NUGYO' : grupSec == '11' ? 'BIST:POLHO' : grupSec == '12' ? 'BIST:SKBNK' : grupSec == '13' ? 'BIST:TSGYO' : grupSec == '14' ? 'BIST:YGGYO' :grupSec == "ÖZEL LİSTE" ? c06: na
s07 = grupSec == '1' ? 'BIST:AFYON' : grupSec == '2' ? 'BIST:ASUZU' : grupSec == '3' ? 'BIST:BORLS' : grupSec == '4' ? 'BIST:DERHL' : grupSec == '5' ? 'BIST:ENJSA' : grupSec == '6' ? 'BIST:GLRYH' : grupSec == '7' ? 'BIST:INDES' : grupSec == '8' ? 'BIST:KLGYO' : grupSec == '9' ? 'BIST:MAALT' : grupSec == '10' ? 'BIST:NUHCM' : grupSec == '11' ? 'BIST:POLTK' : grupSec == '12' ? 'BIST:SKTAS' : grupSec == '13' ? 'BIST:TSKB'  : grupSec == '14' ? 'BIST:YGYO'  :grupSec == "ÖZEL LİSTE" ? c07: na
s08 = grupSec == '1' ? 'BIST:AGESA' : grupSec == '2' ? 'BIST:ATAGY' : grupSec == '3' ? 'BIST:BOSSA' : grupSec == '4' ? 'BIST:DERIM' : grupSec == '5' ? 'BIST:ENKAI' : grupSec == '6' ? 'BIST:GLYHO' : grupSec == '7' ? 'BIST:INFO'  : grupSec == '8' ? 'BIST:KLKIM' : grupSec == '9' ? 'BIST:MACKO' : grupSec == '10' ? 'BIST:OBASE' : grupSec == '11' ? 'BIST:PRDGS' : grupSec == '12' ? 'BIST:SMART' : grupSec == '13' ? 'BIST:TSPOR' : grupSec == '14' ? 'BIST:YKBNK' :grupSec == "ÖZEL LİSTE" ? c08: na
s09 = grupSec == '1' ? 'BIST:AGHOL' : grupSec == '2' ? 'BIST:ATAKP' : grupSec == '3' ? 'BIST:BRISA' : grupSec == '4' ? 'BIST:DESA'  : grupSec == '5' ? 'BIST:ENSRI' : grupSec == '6' ? 'BIST:GMTAS' : grupSec == '7' ? 'BIST:INGRM' : grupSec == '8' ? 'BIST:KLMSN' : grupSec == '9' ? 'BIST:MAGEN' : grupSec == '10' ? 'BIST:ODAS'  : grupSec == '11' ? 'BIST:PRKAB' : grupSec == '12' ? 'BIST:SMRTG' : grupSec == '13' ? 'BIST:TTKOM' : grupSec == '14' ? 'BIST:YKSLN' :grupSec == "ÖZEL LİSTE" ? c09: na
s10 = grupSec == '1' ? 'BIST:AGYO'  : grupSec == '2' ? 'BIST:ATATP' : grupSec == '3' ? 'BIST:BRKO'  : grupSec == '4' ? 'BIST:DESPC' : grupSec == '5' ? 'BIST:EPLAS' : grupSec == '6' ? 'BIST:GOKNR' : grupSec == '7' ? 'BIST:INTEM' : grupSec == '8' ? 'BIST:KLNMA' : grupSec == '9' ? 'BIST:MAKIM' : grupSec == '10' ? 'BIST:OFSYM' : grupSec == '11' ? 'BIST:PRKME' : grupSec == '12' ? 'BIST:SNGYO' : grupSec == '13' ? 'BIST:TTRAK' : grupSec == '14' ? 'BIST:YONGA' :grupSec == "ÖZEL LİSTE" ? c10:na
s11 = grupSec == '1' ? 'BIST:AHGAZ' : grupSec == '2' ? 'BIST:ATEKS' : grupSec == '3' ? 'BIST:BRKSN' : grupSec == '4' ? 'BIST:DEVA'  : grupSec == '5' ? 'BIST:ERBOS' : grupSec == '6' ? 'BIST:GOLTS' : grupSec == '7' ? 'BIST:INVEO' : grupSec == '8' ? 'BIST:KLRHO' : grupSec == '9' ? 'BIST:MAKTK' : grupSec == '10' ? 'BIST:ONCSM' : grupSec == '11' ? 'BIST:PRZMA' : grupSec == '12' ? 'BIST:SNICA' : grupSec == '13' ? 'BIST:TUCLK' : grupSec == '14' ? 'BIST:YUNSA' :grupSec == "ÖZEL LİSTE" ? c11:na
s12 = grupSec == '1' ? 'BIST:AKBNK' : grupSec == '2' ? 'BIST:ATLAS' : grupSec == '3' ? 'BIST:BRKVY' : grupSec == '4' ? 'BIST:DGATE' : grupSec == '5' ? 'BIST:ERCB'  : grupSec == '6' ? 'BIST:GOODY' : grupSec == '7' ? 'BIST:INVES' : grupSec == '8' ? 'BIST:KLSER' : grupSec == '9' ? 'BIST:MANAS' : grupSec == '10' ? 'BIST:ORCAY' : grupSec == '11' ? 'BIST:PSDTC' : grupSec == '12' ? 'BIST:SNKRN' : grupSec == '13' ? 'BIST:TUKAS' : grupSec == '14' ? 'BIST:YYAPI' :grupSec == "ÖZEL LİSTE" ? c12:na
s13 = grupSec == '1' ? 'BIST:AKCNS' : grupSec == '2' ? 'BIST:ATSYH' : grupSec == '3' ? 'BIST:BRLSM' : grupSec == '4' ? 'BIST:DGGYO' : grupSec == '5' ? 'BIST:EREGL' : grupSec == '6' ? 'BIST:GOZDE' : grupSec == '7' ? 'BIST:IPEKE' : grupSec == '8' ? 'BIST:KLSYN' : grupSec == '9' ? 'BIST:MARBL' : grupSec == '10' ? 'BIST:ORGE'  : grupSec == '11' ? 'BIST:PSGYO' : grupSec == '12' ? 'BIST:SNPAM' : grupSec == '13' ? 'BIST:TUPRS' : grupSec == '14' ? 'BIST:YYLGD' :grupSec == "ÖZEL LİSTE" ? c13:na
s14 = grupSec == '1' ? 'BIST:AKENR' : grupSec == '2' ? 'BIST:AVGYO' : grupSec == '3' ? 'BIST:BRMEN' : grupSec == '4' ? 'BIST:DGNMO' : grupSec == '5' ? 'BIST:ERSU'  : grupSec == '6' ? 'BIST:GRNYO' : grupSec == '7' ? 'BIST:ISATR' : grupSec == '8' ? 'BIST:KMPUR' : grupSec == '9' ? 'BIST:MARKA' : grupSec == '10' ? 'BIST:ORMA'  : grupSec == '11' ? 'BIST:QNBFB' : grupSec == '12' ? 'BIST:SODSN' : grupSec == '13' ? 'BIST:TUREX' : grupSec == '14' ? 'BIST:ZEDUR' :grupSec == "ÖZEL LİSTE" ? c14:na
s15 = grupSec == '1' ? 'BIST:AKFGY' : grupSec == '2' ? 'BIST:AVHOL' : grupSec == '3' ? 'BIST:BRSAN' : grupSec == '4' ? 'BIST:DIRIT' : grupSec == '5' ? 'BIST:ESCAR' : grupSec == '6' ? 'BIST:GRSEL' : grupSec == '7' ? 'BIST:ISBIR' : grupSec == '8' ? 'BIST:KNFRT' : grupSec == '9' ? 'BIST:MARTI' : grupSec == '10' ? 'BIST:OSMEN' : grupSec == '11' ? 'BIST:QNBFL' : grupSec == '12' ? 'BIST:SOKE'  : grupSec == '13' ? 'BIST:TURGG' : grupSec == '14' ? 'BIST:ZOREN' :grupSec == "ÖZEL LİSTE" ? c15:na
s16 = grupSec == '1' ? 'BIST:AKFYE' : grupSec == '2' ? 'BIST:AVOD'  : grupSec == '3' ? 'BIST:BRYAT' : grupSec == '4' ? 'BIST:DITAS' : grupSec == '5' ? 'BIST:ESCOM' : grupSec == '6' ? 'BIST:GRTRK' : grupSec == '7' ? 'BIST:ISBTR' : grupSec == '8' ? 'BIST:KONKA' : grupSec == '9' ? 'BIST:MAVI'  : grupSec == '10' ? 'BIST:OSTIM' : grupSec == '11' ? 'BIST:QUAGR' : grupSec == '12' ? 'BIST:SOKM'  : grupSec == '13' ? 'BIST:TURSG' : grupSec == '14' ? 'BIST:ZRGYO' :grupSec == "ÖZEL LİSTE" ? c16:na
s17 = grupSec == '1' ? 'BIST:AKGRT' : grupSec == '2' ? 'BIST:AVTUR' : grupSec == '3' ? 'BIST:BSOKE' : grupSec == '4' ? 'BIST:DMRGD' : grupSec == '5' ? 'BIST:ESEN'  : grupSec == '6' ? 'BIST:GSDDE' : grupSec == '7' ? 'BIST:ISCTR' : grupSec == '8' ? 'BIST:KONTR' : grupSec == '9' ? 'BIST:MEDTR' : grupSec == '10' ? 'BIST:OTKAR' : grupSec == '11' ? 'BIST:RALYH' : grupSec == '12' ? 'BIST:SONME' : grupSec == '13' ? 'BIST:UFUK'  : grupSec == '14' ? 'BIST:ZRGYO'  :grupSec == "ÖZEL LİSTE" ? c17:na
s18 = grupSec == '1' ? 'BIST:AKMGY' : grupSec == '2' ? 'BIST:AYCES' : grupSec == '3' ? 'BIST:BTCIM' : grupSec == '4' ? 'BIST:DMSAS' : grupSec == '5' ? 'BIST:ETILR' : grupSec == '6' ? 'BIST:GSDHO' : grupSec == '7' ? 'BIST:ISDMR' : grupSec == '8' ? 'BIST:KONYA' : grupSec == '9' ? 'BIST:MEGAP' : grupSec == '10' ? 'BIST:OTTO'  : grupSec == '11' ? 'BIST:RAYSG' : grupSec == '12' ? 'BIST:SRVGY' : grupSec == '13' ? 'BIST:ULAS'  : grupSec == '14' ? 'BIST:ZRGYO'  :grupSec == "ÖZEL LİSTE" ? c18:na
s19 = grupSec == '1' ? 'BIST:AKSA'  : grupSec == '2' ? 'BIST:AYDEM' : grupSec == '3' ? 'BIST:BUCIM' : grupSec == '4' ? 'BIST:DNISI' : grupSec == '5' ? 'BIST:ETYAT' : grupSec == '6' ? 'BIST:GSRAY' : grupSec == '7' ? 'BIST:ISFIN' : grupSec == '8' ? 'BIST:KOPOL' : grupSec == '9' ? 'BIST:MEKAG' : grupSec == '10' ? 'BIST:OYAKC' : grupSec == '11' ? 'BIST:REEDR' : grupSec == '12' ? 'BIST:SUMAS' : grupSec == '13' ? 'BIST:ULKER' : grupSec == '14' ? 'BIST:ZRGYO'  :grupSec == "ÖZEL LİSTE" ? c19:na
s20 = grupSec == '1' ? 'BIST:AKSEN' : grupSec == '2' ? 'BIST:AYEN'  : grupSec == '3' ? 'BIST:BURCE' : grupSec == '4' ? 'BIST:DOAS'  : grupSec == '5' ? 'BIST:EUHOL' : grupSec == '6' ? 'BIST:GUBRF' : grupSec == '7' ? 'BIST:ISGSY' : grupSec == '8' ? 'BIST:KORDS' : grupSec == '9' ? 'BIST:MEPET' : grupSec == '10' ? 'BIST:OYAYO' : grupSec == '11' ? 'BIST:RNPOL' : grupSec == '12' ? 'BIST:SUNTK' : grupSec == '13' ? 'BIST:ULUFA' : grupSec == '14' ? 'BIST:ZRGYO'  :grupSec == "ÖZEL LİSTE" ? c20:na

//////////////////
// CALCULATIONS //

// Get only prefix
only_prefix(s) =>
    array.get(str.split(s, ":"), 0)
// Get only symbol
only_symbol(s) => 
    array.get(str.split(s, ":"), 1)





///////////
// PLOT //
///////////////////////////////////////////////
ema_1 = input(5)
ema_2 = input(21)
ema1_ = ta.ema(close,ema_1)
ema2_ = ta.ema(close,ema_2)
plot(ema1_,color = color.green)
plot(ema2_,color = color.red)

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////// MOMENTUM


greencolor = #2DD204
redcolor = #D2042D 

smthtype = "Kaufman"
srcin = input.string("Close", "Source", 
	 options = ["Close", "Open", "High", "Low"],group='Source Settings')

inpPeriod =50

sigtype = "Middle"
upperlvl = 0.8
lowerlvl = 0.2

colorbars = true
showSigs = input.bool(true, "Show Signals?", group = "UI Options")

kfl = 0.666
ksl = 0.0645
amafl = 2
amasl = 30
t3hot = input.float(.7, "* T3 Only - T3 Hot", group = "Moving Average Inputs")
t3swt = input.string("T3 New", "* T3 Only - T3 Type", options = ["T3 New", "T3 Original"], group = "Moving Average Inputs")

haclose  =  ohlc4
haopen   = float(na)
haopen  := na(haopen[1]) ? (open + close) / 2 : (nz(haopen[1]) + nz(haclose[1])) / 2
hahigh   =math.max(high, math.max(haopen, haclose))
halow    = math.min(low,  math.min(haopen, haclose))
hamedian = (hahigh + halow) / 2
hatypical = (hahigh + halow + haclose) / 3
haweighted =  (hahigh + halow + haclose + haclose)/4 
haaverage =  (haopen + hahigh + halow + haclose)/4

sourceout(smthtype, srcin)=>
	src = switch srcin
		"Close" => close

		=> close

emaN = 0.
emaa = 0.
emab = 0.

alpha = 2.0 / (1.0 * inpPeriod)

emaN := nz(emaN[1]) + alpha * (sourceout(smthtype, srcin) - nz(emaN[1]))

ratioa = emaN/emaN[1]

emaa := nz(emaa[1]) + alpha * ((ratioa < 1.0 ? ratioa : 0) - nz(emaa[1]))
emab := nz(emab[1]) + alpha * ((ratioa > 1.0 ? ratioa : 0) - nz(emab[1]))

ratiob = ratioa / (ratioa + emab)

val = 2.0 * ratioa / (ratioa + ratiob * emaa) - 1.0
sigN = val[1]

middle = 0.5
colorout = sigtype == "Middle" ? val > middle ? greencolor : redcolor : sigtype == "Signal" ? val > sigN ? greencolor : redcolor : val > upperlvl ? greencolor : val < lowerlvl ? redcolor : color.gray

barcolor(colorbars ? colorout : na)

goLong =  sigtype == "Middle" ? ta.crossover(val, middle) :  sigtype == "Signal" ? ta.crossover(val, sigN) : ta.crossover(val, upperlvl) 
goShort = sigtype == "Middle" ? ta.crossunder(val, middle) : sigtype == "Signal" ? ta.crossunder(val, sigN) : ta.crossunder(val, lowerlvl) 

//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////DMI DMI DMI
adxlen = input(14, title='ADX Smoothing')
dilen = input(14, title='DI Length')
dirmova(len) =>
    up = ta.change(high)
    down = -ta.change(low)
    truerange = ta.rma(ta.tr, len)
    plus = fixnan(100 * ta.rma(up > down and up > 0 ? up : 0, len) / truerange)
    minus = fixnan(100 * ta.rma(down > up and down > 0 ? down : 0, len) / truerange)
    [plus, minus]

adxaa(dilen, adxlen) =>
    [plus, minus] = dirmova(dilen)
    sum = plus + minus
    adx = 100 * ta.rma(math.abs(plus - minus) / (sum == 0 ? 1 : sum), adxlen)
    [adx, plus, minus]

[sig, up, down] = adxaa(dilen, adxlen)



//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////// SUPERTREND SUPERTREND 
atrPeriod = input(14, "ATR Length")
factor = input(2, "Factor")

[supertrend, direction] = ta.supertrend(factor, atrPeriod)

bodyMiddle = plot((open + close) / 2, display=display.none)


/////////////SUPERTREND 2 
atrPeriod_2 = input(21, "ATR Length")
factor_2 = input(1, "Factor")

[supertrend_2, direction_2] = ta.supertrend(factor_2, atrPeriod_2)

bodyMiddle_2 = plot((open + close) / 2, display=display.none)

//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////// TILSON TILSON
T3FiboLine = input(false, title='Show T3 Fibonacci Ratio Line?')


length1 = input(8, 'T3 Length')
a1 = input(0.7, 'Volume Factor')

e1 = ta.ema((high + low + 2 * close) / 4, length1)
e2 = ta.ema(e1, length1)
e3 = ta.ema(e2, length1)
e4 = ta.ema(e3, length1)
e5 = ta.ema(e4, length1)
e6 = ta.ema(e5, length1)
c1 = -a1 * a1 * a1
c2 = 3 * a1 * a1 + 3 * a1 * a1 * a1
c3 = -6 * a1 * a1 - 3 * a1 - 3 * a1 * a1 * a1
c4 = 1 + 3 * a1 + a1 * a1 * a1 + 3 * a1 * a1
T3 = c1 * e6 + c2 * e5 + c3 * e4 + c4 * e3

col1 = T3 > T3[1]
col3 = T3 < T3[1]
color_1 = col1 ? color.green : col3 ? color.red : color.yellow


//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////// OTT OTT OTT 
srca = input(close, title='Source')
lenan = input.int(2, 'OTT Period', minval=1)
percent = input.float(1.4, 'OTT Percent', step=0.1, minval=0)
showsupport = input(title='Show Support Line?', defval=true)
showsignalsk = input(title='Show Support Line Crossing Signals?', defval=true)
showsignalsc = false
highlight = false
showsignalsr = false
highlighting = input(title='Highlighter On/Off ?', defval=true)
mav = input.string(title='Moving Average Type', defval='VAR', options=['SMA', 'EMA', 'WMA', 'TMA', 'VAR', 'WWMA', 'ZLEMA', 'TSF'])
Var_Func(srca, lenan) =>
    valpha = 2 / (lenan + 1)
    vud1 = srca > srca[1] ? srca - srca[1] : 0
    vdd1 = srca < srca[1] ? srca[1] - srca : 0
    vUD = math.sum(vud1, 9)
    vDD = math.sum(vdd1, 9)
    vCMO = nz((vUD - vDD) / (vUD + vDD))
    VAR = 0.0
    VAR := nz(valpha * math.abs(vCMO) * srca) + (1 - valpha * math.abs(vCMO)) * nz(VAR[1])
    VAR
VAR = Var_Func(srca, lenan)
Wwma_Func(srca, lenan) =>
    wwalpha = 1 / lenan
    WWMA = 0.0
    WWMA := wwalpha * srca + (1 - wwalpha) * nz(WWMA[1])
    WWMA
WWMA = Wwma_Func(srca, lenan)
Zlema_Func(srca, lenan) =>
    zxLag = lenan / 2 == math.round(lenan / 2) ? lenan / 2 : (lenan - 1) / 2
    zxEMAData = srca + srca - srca[zxLag]
    ZLEMA = ta.ema(zxEMAData, lenan)
    ZLEMA
ZLEMA = Zlema_Func(srca, lenan)
Tsf_Func(srca, lenan) =>
    lrc = ta.linreg(srca, lenan, 0)
    lrc1 = ta.linreg(srca, lenan, 1)
    lrs = lrc - lrc1
    TSF = ta.linreg(srca, lenan, 0) + lrs
    TSF
TSF = Tsf_Func(srca, lenan)
getMA(srca, lenan) =>
    ma = 0.0
    if mav == 'SMA'
        ma := ta.sma(srca, lenan)
        ma

    if mav == 'EMA'
        ma := ta.ema(srca, lenan)
        ma

    if mav == 'WMA'
        ma := ta.wma(srca, lenan)
        ma

    if mav == 'TMA'
        ma := ta.sma(ta.sma(srca, math.ceil(lenan / 2)), math.floor(lenan / 2) + 1)
        ma

    if mav == 'VAR'
        ma := VAR
        ma

    if mav == 'WWMA'
        ma := WWMA
        ma

    if mav == 'ZLEMA'
        ma := ZLEMA
        ma

    if mav == 'TSF'
        ma := TSF
        ma
    ma

MAvg = getMA(srca, lenan)
fark = MAvg * percent * 0.01
longStop = MAvg - fark
longStopPrev = nz(longStop[1], longStop)
longStop := MAvg > longStopPrev ? math.max(longStop, longStopPrev) : longStop
shortStop = MAvg + fark
shortStopPrev = nz(shortStop[1], shortStop)
shortStop := MAvg < shortStopPrev ? math.min(shortStop, shortStopPrev) : shortStop
dir = 1
dir := nz(dir[1], dir)
dir := dir == -1 and MAvg > shortStopPrev ? 1 : dir == 1 and MAvg < longStopPrev ? -1 : dir
MT = dir == 1 ? longStop : shortStop
OTT = MAvg > MT ? MT * (200 + percent) / 200 : MT * (200 - percent) / 200
plot(showsupport ? MAvg : na, color=color.new(#0585E1, 0), linewidth=2, title='Support Line')
OTTC = highlight ? OTT[2] > OTT[3] ? color.green : color.red : #B800D9
pALL = plot(nz(OTT[2]), color=OTTC, linewidth=2, title='OTT', transp=0)

buySignalk = ta.crossover(MAvg, OTT[2])
plotshape(buySignalk and showsignalsk ? OTT * 0.995 : na, title='Buy', text='Buy', location=location.absolute, style=shape.labelup, size=size.tiny, color=color.new(color.green, 0), textcolor=color.new(color.white, 0))
sellSignallk = ta.crossunder(MAvg, OTT[2])
plotshape(sellSignallk and showsignalsk ? OTT * 1.005 : na, title='Sell', text='Sell', location=location.absolute, style=shape.labeldown, size=size.tiny, color=color.new(color.red, 0), textcolor=color.new(color.white, 0))


///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


screener_func() =>
    
     //EMA EMA EMA 
    adxTrendUp = ema1_>ema2_ ////yükseliş
    adxTrendUpStrong = ema1_>ema2_ and close>ema1_ ///güçlü yükseliş
    adxTrendUpFalling = ema1_>ema2_ and close<ema1_ ///zayıf yükseliş
    adxTrendDown = ema1_<ema2_
    adxTrendDownStrong = ema1_<ema2_ and close<ema1_
    adxTrendDownFalling = ema1_<ema2_ and close>ema1_

    //DMI \\
    bbOpenUp =up>down
    bbOpenDown = up<down
    bbParallelUp = up>down
    bbParallelDown =up<down
    bbClose = up==down

    // SUPERTREND  \\
    trixUp = direction < 0 and direction_2>0  ////////////// YÜKSELİŞ TRENDİ 
    trixUpstr = direction_2<0 ///////////////GÜÇLÜ YÜKSELİŞ
    trixDown = direction > 0  and direction_2<0/////////////// DÜŞÜŞ TRENDİ 
    trixDownstr = direction_2>0 /////////////GÜÇLÜ DÜŞÜŞ TRENDİ 

    // TILLSON \\
    stochDown = col3
    stochUp = col1


    //OTT//OTT/OTT
    buyott =MAvg> OTT[2]
    sellott= MAvg<OTT[2]


    // Stoch Screener
    StochDidi = switch
        stochDown => "negatif"
        stochUp => "pozitif"

    // Trix Screener
    trixdidi = switch
        trixUp => "YÜKSELİŞ TRENDİ"
        trixUpstr=> "GÜÇLÜ YÜKSELİŞ TRENDİ"
        trixDown => "DÜŞÜŞ TRENDİ"
        trixDownstr=>"GÜÇLÜ DÜŞÜŞ TRENDİ"

    // dmı
    bb = switch
        bbOpenUp => "pozitif"
        bbOpenDown => "negatif"
        bbParallelUp => "pozitif"
        bbParallelDown => "negatif"
        => "Close"

    // ADX Result Screener
    adxd = switch
        adxTrendUp => "pozitif"
        adxTrendUpStrong => "pozitif"
        adxTrendUpFalling => "pozitif"
        adxTrendDown => "negatif"
        adxTrendDownStrong => "negatif"
        adxTrendDownFalling => "negatif"
        
    ott = switch
        buyott=>"pozitif"
        sellott=>"negatif"


    [adxd, bb, trixdidi, StochDidi,ott]

// Security call
[adxd01, bb01, trixdidi01, stochDidi01,ott01] = request.security(s01, timeframe.period, screener_func())
[adxd02, bb02, trixdidi02, stochDidi02,ott02] = request.security(s02, timeframe.period, screener_func())
[adxd03, bb03, trixdidi03, stochDidi03,ott03] = request.security(s03, timeframe.period, screener_func())
[adxd04, bb04, trixdidi04, stochDidi04,ott04] = request.security(s04, timeframe.period, screener_func())
[adxd05, bb05, trixdidi05, stochDidi05,ott05] = request.security(s05, timeframe.period, screener_func())
[adxd06, bb06, trixdidi06, stochDidi06,ott06] = request.security(s06, timeframe.period, screener_func())
[adxd07, bb07, trixdidi07, stochDidi07,ott07] = request.security(s07, timeframe.period, screener_func())
[adxd08, bb08, trixdidi08, stochDidi08,ott08] = request.security(s08, timeframe.period, screener_func())
[adxd09, bb09, trixdidi09, stochDidi09,ott09] = request.security(s09, timeframe.period, screener_func())
[adxd10, bb10, trixdidi10, stochDidi10,ott10] = request.security(s10, timeframe.period, screener_func())
[adxd11, bb11, trixdidi11, stochDidi11,ott11] = request.security(s11, timeframe.period, screener_func())
[adxd12, bb12, trixdidi12, stochDidi12,ott12] = request.security(s12, timeframe.period, screener_func())
[adxd13, bb13, trixdidi13, stochDidi13,ott13] = request.security(s13, timeframe.period, screener_func())
[adxd14, bb14, trixdidi14, stochDidi14,ott14] = request.security(s14, timeframe.period, screener_func())
[adxd15, bb15, trixdidi15, stochDidi15,ott15] = request.security(s15, timeframe.period, screener_func())
[adxd16, bb16, trixdidi16, stochDidi16,ott16] = request.security(s16, timeframe.period, screener_func())
[adxd17, bb17, trixdidi17, stochDidi17,ott17] = request.security(s17, timeframe.period, screener_func())
[adxd18, bb18, trixdidi18, stochDidi18,ott18] = request.security(s18, timeframe.period, screener_func())
[adxd19, bb19, trixdidi19, stochDidi19,ott19] = request.security(s19, timeframe.period, screener_func())
[adxd20, bb20, trixdidi20, stochDidi20,ott20] = request.security(s20, timeframe.period, screener_func())

////////////
// ARRAYS //

p_arr   = array.new_string(0)
s_arr   = array.new_string(0)
u_arr   = array.new_bool(0)
rsi_arr = array.new_float(0)
adxd_arr = array.new_string(0)
bb_arr = array.new_string(0)
trixdidi_arr = array.new_string(0)
stocchdidi_arr = array.new_string(0)
symboldidi_arr = array.new_string(0)
ottdidi = array.new_string(0)

// Add Prefix
array.push(p_arr, only_prefix(s01))
array.push(p_arr, only_prefix(s02))
array.push(p_arr, only_prefix(s03))
array.push(p_arr, only_prefix(s04))
array.push(p_arr, only_prefix(s05))
array.push(p_arr, only_prefix(s06))
array.push(p_arr, only_prefix(s07))
array.push(p_arr, only_prefix(s08))
array.push(p_arr, only_prefix(s09))
array.push(p_arr, only_prefix(s10))
array.push(p_arr, only_prefix(s11))
array.push(p_arr, only_prefix(s12))
array.push(p_arr, only_prefix(s13))
array.push(p_arr, only_prefix(s14))
array.push(p_arr, only_prefix(s15))
array.push(p_arr, only_prefix(s16))
array.push(p_arr, only_prefix(s17))
array.push(p_arr, only_prefix(s18))
array.push(p_arr, only_prefix(s19))
array.push(p_arr, only_prefix(s20))

// Add ÖZEL LİSTE 
array.push(s_arr, only_symbol(s01))
array.push(s_arr, only_symbol(s02))
array.push(s_arr, only_symbol(s03))
array.push(s_arr, only_symbol(s04))
array.push(s_arr, only_symbol(s05))
array.push(s_arr, only_symbol(s06))
array.push(s_arr, only_symbol(s07))
array.push(s_arr, only_symbol(s08))
array.push(s_arr, only_symbol(s09))
array.push(s_arr, only_symbol(s10))
array.push(s_arr, only_symbol(s11))
array.push(s_arr, only_symbol(s12))
array.push(s_arr, only_symbol(s13))
array.push(s_arr, only_symbol(s14))
array.push(s_arr, only_symbol(s15))
array.push(s_arr, only_symbol(s16))
array.push(s_arr, only_symbol(s17))
array.push(s_arr, only_symbol(s18))
array.push(s_arr, only_symbol(s19))
array.push(s_arr, only_symbol(s20))



// ADX
array.push(adxd_arr, adxd01)
array.push(adxd_arr, adxd02)
array.push(adxd_arr, adxd03)
array.push(adxd_arr, adxd04)
array.push(adxd_arr, adxd05)
array.push(adxd_arr, adxd06)
array.push(adxd_arr, adxd07)
array.push(adxd_arr, adxd08)
array.push(adxd_arr, adxd09)
array.push(adxd_arr, adxd10)
array.push(adxd_arr, adxd11)
array.push(adxd_arr, adxd12)
array.push(adxd_arr, adxd13)
array.push(adxd_arr, adxd14)
array.push(adxd_arr, adxd15)
array.push(adxd_arr, adxd16)
array.push(adxd_arr, adxd17)
array.push(adxd_arr, adxd18)
array.push(adxd_arr, adxd19)
array.push(adxd_arr, adxd20)



// Bollinger Bands
array.push(bb_arr, bb01)
array.push(bb_arr, bb02)
array.push(bb_arr, bb03)
array.push(bb_arr, bb04)
array.push(bb_arr, bb05)
array.push(bb_arr, bb06)
array.push(bb_arr, bb07)
array.push(bb_arr, bb08)
array.push(bb_arr, bb09)
array.push(bb_arr, bb10)
array.push(bb_arr, bb11)
array.push(bb_arr, bb12)
array.push(bb_arr, bb13)
array.push(bb_arr, bb14)
array.push(bb_arr, bb15)
array.push(bb_arr, bb16)
array.push(bb_arr, bb17)
array.push(bb_arr, bb18)
array.push(bb_arr, bb19)
array.push(bb_arr, bb20)

// Trix
array.push(trixdidi_arr, trixdidi01)
array.push(trixdidi_arr, trixdidi02)
array.push(trixdidi_arr, trixdidi03)
array.push(trixdidi_arr, trixdidi04)
array.push(trixdidi_arr, trixdidi05)
array.push(trixdidi_arr, trixdidi06)
array.push(trixdidi_arr, trixdidi07)
array.push(trixdidi_arr, trixdidi08)
array.push(trixdidi_arr, trixdidi09)
array.push(trixdidi_arr, trixdidi10)
array.push(trixdidi_arr, trixdidi11)
array.push(trixdidi_arr, trixdidi12)
array.push(trixdidi_arr, trixdidi13)
array.push(trixdidi_arr, trixdidi14)
array.push(trixdidi_arr, trixdidi15)
array.push(trixdidi_arr, trixdidi16)
array.push(trixdidi_arr, trixdidi17)
array.push(trixdidi_arr, trixdidi18)
array.push(trixdidi_arr, trixdidi19)
array.push(trixdidi_arr, trixdidi20)


// Stoch
array.push(stocchdidi_arr, stochDidi01)
array.push(stocchdidi_arr, stochDidi02)
array.push(stocchdidi_arr, stochDidi03)
array.push(stocchdidi_arr, stochDidi04)
array.push(stocchdidi_arr, stochDidi05)
array.push(stocchdidi_arr, stochDidi06)
array.push(stocchdidi_arr, stochDidi07)
array.push(stocchdidi_arr, stochDidi08)
array.push(stocchdidi_arr, stochDidi09)
array.push(stocchdidi_arr, stochDidi10)
array.push(stocchdidi_arr, stochDidi11)
array.push(stocchdidi_arr, stochDidi12)
array.push(stocchdidi_arr, stochDidi13)
array.push(stocchdidi_arr, stochDidi14)
array.push(stocchdidi_arr, stochDidi15)
array.push(stocchdidi_arr, stochDidi16)
array.push(stocchdidi_arr, stochDidi17)
array.push(stocchdidi_arr, stochDidi18)
array.push(stocchdidi_arr, stochDidi19)
array.push(stocchdidi_arr, stochDidi20)
///////////////////////////////////////

// FLAGS 

array.push(u_arr, u01)
array.push(u_arr, u02)
array.push(u_arr, u03)
array.push(u_arr, u04)
array.push(u_arr, u05)
array.push(u_arr, u06)
array.push(u_arr, u07)
array.push(u_arr, u08)
array.push(u_arr, u09)
array.push(u_arr, u10)
array.push(u_arr, u11)
array.push(u_arr, u12)
array.push(u_arr, u13)
array.push(u_arr, u14)
array.push(u_arr, u15)
array.push(u_arr, u16)
array.push(u_arr, u17)
array.push(u_arr, u18)
array.push(u_arr, u19)
array.push(u_arr, u20)
//////////////////////////////////////////////did array


///////////////////////////////OTT 
array.push(ottdidi, ott01)
array.push(ottdidi, ott02)
array.push(ottdidi, ott03)
array.push(ottdidi, ott04)
array.push(ottdidi, ott05)
array.push(ottdidi, ott06)
array.push(ottdidi, ott07)
array.push(ottdidi, ott08)
array.push(ottdidi, ott09)
array.push(ottdidi, ott10)
array.push(ottdidi, ott11)
array.push(ottdidi, ott12)
array.push(ottdidi, ott13)
array.push(ottdidi, ott14)
array.push(ottdidi, ott15)
array.push(ottdidi, ott16)
array.push(ottdidi, ott17)
array.push(ottdidi, ott18)
array.push(ottdidi, ott19)
array.push(ottdidi, ott20)


alimcolor = input.color(color.green)
satimcolor = input.color(color.red)
strbuy = input.color(color.rgb(79, 237, 84))
strsell = input.color(color.rgb(255, 32, 32))

///////////
// PLOTS //

var tbl = table.new(position.bottom_right, 8, 41, frame_color=#151715, frame_width=1, border_width=1, border_color=color.new(color.white, 100))

if barstate.islast


    table.cell(tbl, 0, 0, 'Symbol', width = col_width,     text_halign = text.align_center, bgcolor = color.gray, text_color = color.white, text_size = size.normal)
    table.cell(tbl, 1, 0, 'EMA',    width = col_width,     text_halign = text.align_center, bgcolor = color.gray, text_color = color.white, text_size = size.normal)
    table.cell(tbl, 2, 0, 'DMI',     width = col_width,     text_halign = text.align_center, bgcolor = color.gray, text_color = color.white, text_size = size.normal)
    table.cell(tbl, 3, 0, 'SUPERTREND',   width = col_width,     text_halign = text.align_center, bgcolor = color.gray, text_color = color.white, text_size = size.normal)
    table.cell(tbl, 4, 0, 'TİLSON',  width = col_width,     text_halign = text.align_center, bgcolor = color.gray, text_color = color.white, text_size = size.normal)
    table.cell(tbl, 5, 0, 'OTT',  width = col_width,     text_halign = text.align_center, bgcolor = color.gray, text_color = color.white, text_size = size.normal)
    if (scr_numb > 1)
        table.cell(tbl, 6, 0, '', width = col_width * 2 * (scr_numb - 1),     text_halign = text.align_center, bgcolor = color.new(color.gray, 100), text_color = color.white, text_size = size.small)
        

    for i = 0 to 19
        if array.get(u_arr, i)

            adx_color = array.get(adxd_arr, i) == "pozitif" ?  alimcolor : satimcolor
            dmi_color = array.get(bb_arr, i) == "pozitif" ?alimcolor:satimcolor
            trix_color = array.get(trixdidi_arr, i) == "YÜKSELİŞ TRENDİ" ?alimcolor:array.get(trixdidi_arr, i)== "GÜÇLÜ YÜKSELİŞ TRENDİ" ? strbuy : array.get(trixdidi_arr, i) == "DÜŞÜŞ TRENDİ" ? satimcolor : array.get(trixdidi_arr, i)=="GÜÇLÜ DÜŞÜŞ TRENDİ"?strsell:na 
            stoc_color = array.get(stocchdidi_arr, i) == "pozitif" ?alimcolor:satimcolor
            ott_color = array.get(ottdidi, i) == "pozitif" ?alimcolor:satimcolor
            
            
            table.cell(tbl, 0, i + 1, array.get(s_arr, i),          text_halign = text.align_center, bgcolor =color.gray,  text_color = color.white, text_size = size.small)
            table.cell(tbl, 1, i + 1, array.get(adxd_arr, i),       text_halign = text.align_center, bgcolor =adx_color,        text_color = color.white, text_size = size.small)
            table.cell(tbl, 2, i + 1, array.get(bb_arr, i),       text_halign = text.align_center, bgcolor = dmi_color,        text_color = color.white, text_size = size.small)
            table.cell(tbl, 3, i + 1, array.get(trixdidi_arr, i),         text_halign = text.align_center, bgcolor =trix_color,          text_color = color.white, text_size = size.small)
            table.cell(tbl, 4, i + 1, array.get(stocchdidi_arr, i),   text_halign = text.align_center, bgcolor =stoc_color,        text_color = color.white, text_size = size.small)
            table.cell(tbl, 5, i + 1, array.get(ottdidi, i), text_halign = text.align_center, bgcolor = ott_color,       text_color = color.white, text_size = size.small)
