//@version=5
strategy("PENGU Bollinger Bands", shorttitle="PENGU BB", overlay=true,
         initial_capital=10000, commission_type=strategy.commission.percent, commission_value=0.1)

// ============================================================================
// PENGU BOLLINGER BANDS STRATEGY
// Test Results: +3.97% return, 76.9% Win Rate, 13 trades
// ============================================================================

// Inputs
bb_length = input.int(20, title="Bollinger Length", minval=5, maxval=50)
bb_std = input.float(2.0, title="Standard Deviation", minval=1.0, maxval=3.0, step=0.1)

// Risk Management
stop_loss_pct = input.float(2.0, title="Stop Loss %", minval=0.5, maxval=5.0, step=0.1)
take_profit_pct = input.float(1.0, title="Take Profit %", minval=0.3, maxval=3.0, step=0.1)

// Bollinger Bands
bb_basis = ta.sma(close, bb_length)
bb_dev = bb_std * ta.stdev(close, bb_length)
bb_upper = bb_basis + bb_dev
bb_lower = bb_basis - bb_dev

// Signals
// Buy: Price bounces off lower band
buy_signal = ta.crossover(close, bb_lower)

// Sell: Price bounces off upper band
sell_signal = ta.crossunder(close, bb_upper)

// Strategy
var float entry_price = na

// Entry
if buy_signal and strategy.position_size == 0
    entry_price := close
    strategy.entry("Long", strategy.long, comment="BB Buy")

// Exit with TP/SL
if strategy.position_size > 0 and not na(entry_price)
    current_return = ((close - entry_price) / entry_price) * 100
    
    // TP
    if current_return >= take_profit_pct
        strategy.close("Long", comment="TP")
        entry_price := na
    // SL
    else if current_return <= -stop_loss_pct
        strategy.close("Long", comment="SL")
        entry_price := na

// Sell signal exit
if sell_signal and strategy.position_size > 0
    strategy.close("Long", comment="BB Sell")
    entry_price := na

// Plotting
plot(bb_upper, title="Upper Band", color=color.red, linewidth=1)
plot(bb_basis, title="Middle Band", color=color.blue, linewidth=1)
plot(bb_lower, title="Lower Band", color=color.green, linewidth=1)

bgcolor(close > bb_upper ? color.new(color.red, 95) : 
        close < bb_lower ? color.new(color.green, 95) : na)

plotshape(buy_signal, title="Buy", location=location.belowbar,
          color=color.green, style=shape.triangleup, size=size.small)
plotshape(sell_signal, title="Sell", location=location.abovebar,
          color=color.red, style=shape.triangledown, size=size.small)

